<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Flight Delay Predictor</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <h2>Flight Delay Prediction</h2>

    <div class="container">
        <!-- Left column: Form -->
        <div class="form-section">
            <h3 style="margin-bottom:15px; color:#1f3c88; text-align:center;">Flight Details</h3>
            <form method="post">
                <label>Origin:</label>
                <select name="origin" required>
                    {% for a in airports %}
                        <option value="{{a}}">{{a}}</option>
                    {% endfor %}
                </select>

                <label>Destination:</label>
                <select name="destination" required>
                    {% for a in airports %}
                        <option value="{{a}}">{{a}}</option>
                    {% endfor %}
                </select>

                <label>Airline:</label>
                <select name="airline" required>
                    {% for al in airlines %}
                        <option value="{{al}}">{{al}}</option>
                    {% endfor %}
                </select>

                <label>Day of Week:</label>
                <select name="day_of_week" required>
                    {% for val, day in days %}
                        <option value="{{val}}">{{day}}</option>
                    {% endfor %}
                </select>

                <label>Departure Time:</label>
                <input type="time" name="dep_time" required>

                <label>Weather:</label>
                <div class="weather-options">
                    {% for w in weathers %}
                        <button type="button" class="weather-btn" onclick="selectWeather('{{w}}', this)">
                            {{w}}
                        </button>
                    {% endfor %}
                </div>
                <input type="hidden" name="weather" id="weatherInput" value="Clear">

                <button type="submit">Predict Delay</button>
            </form>
        </div>

        <!-- Right column: Results -->
        <div class="result-section">
            {% if predicted_delay is not none %}
                <div class="result">
                    <h3>Maximum Predicted Delay: {{ predicted_delay }} minutes</h3>
                </div>
            {% endif %}

            {% if historical_delays is not none %}
                <h3>Recent Historical Delays for this Route</h3>
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Airline</th>
                                <th>Scheduled Departure</th>
                                <th>Weather</th>
                                <th>Delay (min)</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for row in historical_delays.itertuples() %}
                            <tr>
                                <td>{{ row.Airline }}</td>
                                <td>
                                    {% if row.ScheduledDeparture.__class__.__name__ == 'Timestamp' %}
                                        {{ row.ScheduledDeparture.strftime("%H:%M") }}
                                    {% else %}
                                        {{ "%02d:%02d" % (row.ScheduledDeparture // 100, row.ScheduledDeparture % 100) }}
                                    {% endif %}
                                </td>
                                <td>{{ row.Weather }}</td>
                                <td>{{ row.DepDelayMinutes }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% endif %}
        </div>
    </div>

    <script>
        function selectWeather(value, btn) {
            document.getElementById("weatherInput").value = value;
            document.querySelectorAll(".weather-btn").forEach(el => el.classList.remove("active"));
            btn.classList.add("active");
        }
    </script>
</body>
</html>
